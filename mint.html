<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Emberholm Portal : Invocation Console</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #000;
      --line: #f5a500;
      --text: #f5a500;
      --font: "Consolas","Courier New",monospace;
    }
    * { box-sizing: border-box; }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: var(--font);
      margin: 0;
      padding: 12px;
    }
    .main-frame {
      border: 3px solid var(--line);
      background:#000;
      max-width: 1180px;
      margin: 0 auto 40px;
      padding: 10px;
    }
    .header-row {
      display:flex;
      justify-content:space-between;
      align-items:center;
      border-bottom:2px solid var(--line);
      margin-bottom:8px;
      padding-bottom:6px;
    }
    .title { font-weight:700; }
    .status {
      font-size:11px;
      border:1px solid var(--line);
      padding:3px 6px;
      background:#110a00;
    }
    .top-zone {
      display:grid;
      grid-template-columns:1.25fr .75fr;
      gap:10px;
      min-height:260px;
    }
    .console-box {
      border:2px solid var(--line);
      background:#020202;
      padding:6px 8px;
      /* + altura para que no aparezca la barra */
      min-height:240px;
    }
    .console-title { font-size:12px;margin-bottom:6px;color:#fff; }
    .console-log {
      /* más alto, sin barra */
      max-height: 200px;
      overflow-y: hidden;
      border:1px solid rgba(245,165,0,0.15);
      padding:4px;
      background:radial-gradient(circle,rgba(245,165,0,0.06)0%,rgba(0,0,0,0)55%);
    }
    .console-line {
      margin-bottom:3px;
      white-space:pre-wrap;
    }
    .info-row{margin-top:6px;display:flex;gap:6px;flex-wrap:wrap;}
    .tag{border:1px solid var(--line);padding:2px 7px;font-size:11px;background:#100800;}
    .portal-panel{
      border:2px solid var(--line);
      background:#020202;
      display:flex;
      flex-direction:column;
      gap:5px;
      align-items:center;
      padding:6px;
    }
    .portal-panel-title{
      font-size:11px;
      border:1px solid var(--line);
      padding:2px 6px;
      background:#100800;
      text-transform:uppercase;
    }
    .portal-video-wrap{
      width:100%;
      border:2px solid var(--line);
      /* un poco más grande */
      aspect-ratio: 4 / 3;
      overflow:hidden;
      position:relative;
      background:#000;
    }
    video{width:100%;height:100%;object-fit:cover;background:#000;}
    .portal-overlay{
      position:absolute;
      bottom:4px;left:4px;right:4px;
      background:rgba(0,0,0,0.65);
      font-size:10px;
      padding:2px 4px;
    }
    .audio-controls{display:flex;gap:5px;width:100%;}
    .sm-btn{
      flex:1;
      background:#000;
      border:1px solid var(--line);
      color:var(--text);
      font-size:10px;
      cursor:pointer;
      padding:3px 0;
      text-align:center;
    }
    .mint-bar{
      border:2px solid var(--line);
      margin-top:12px;
      padding:6px;
      display:flex;
      align-items:center;
      gap:8px;
      background:#040404;
      flex-wrap:wrap;
    }
    input[type="number"]{
      background:#000;
      border:1px solid var(--line);
      color:#fff;
      width:60px;
      padding:3px;
      font-family:var(--font);
    }
    .btn-invoke{
      background:#f5a500;
      color:#000;
      border:none;
      padding:4px 12px;
      font-weight:700;
      cursor:pointer;
      font-family:var(--font);
      letter-spacing:.5px;
    }
    .btn-invoke:active{filter:brightness(.8);}
    .mint-note{font-size:10px;color:#947330;}
    .invoked-wrapper{
      border:2px solid var(--line);
      margin-top:16px;
      display:none;
      background:#020202;
    }
    .invoked-header{
      text-align:center;
      font-size:11px;
      padding:4px;
      border-bottom:1px solid rgba(245,165,0,0.4);
    }
    .invoked-list{padding:5px 5px 10px;}
    .invoked-item{
      display:flex;
      gap:8px;
      align-items:center;
      border:1px solid rgba(245,165,0,0.4);
      margin-bottom:6px;
      padding:4px;
    }
    .invoked-thumb{
      width:38px;
      height:38px;
      border:1px solid var(--line);
      object-fit:cover;
      background:#000;
    }
    .invoked-text{font-size:12px;}
    .status-bar-bottom{margin-top:10px;font-size:11px;color:#a08a4d;}
    @media(max-width:960px){
      .top-zone{grid-template-columns:1fr;}
      .portal-panel{max-width:360px;}
    }
  </style>
</head>
<body>
  <div class="main-frame">
    <div class="header-row">
      <div class="title">EMBERHOLM PORTAL : NODE-Δ / INVOCATION CONSOLE</div>
      <div class="status" id="mintStatus">STATUS: READY</div>
    </div>

    <div class="top-zone">
      <div class="console-box">
        <div class="console-title">[++] %ΛL_7E–EMBER-LINK._</div>
        <div class="console-log" id="consoleLog"></div>
        <div class="info-row">
          <div class="tag">MODE: RANDOM INVOCATION</div>
          <div class="tag">OBJECTIVE: Keep the Flame alive</div>
          <div class="tag">CYCLE: 72h rotation · 48h energy · Aura for items</div>
        </div>
      </div>

      <div class="portal-panel">
        <div class="portal-panel-title"><span>PORTAL ON HOLD...</span></div>
        <div class="portal-video-wrap">
          <!-- usa ruta relativa aquí -->
          <video id="portalVideo" src="file:///C:/EmberholmServer/static/img/portal.mp4"></video>
          <div class="portal-overlay" id="portalOverlay">Offline portal. Awaiting summons…</div>
        </div>
        <div class="audio-controls">
          <button class="sm-btn" id="audioOnBtn">AUDIO ON</button>
          <button class="sm-btn" id="audioMuteBtn">MUTE</button>
        </div>
      </div>
    </div>

    <div class="mint-bar">
      <label for="qty">Amount to invoke:</label>
      <input type="number" id="qty" min="1" value="3">
      <button class="btn-invoke" id="invokeBtn">[INVOKE]</button>
      <div class="mint-note">*Local simulation. Real Mint via Base.</div>
    </div>

    <div class="invoked-wrapper" id="invokedWrapper">
      <div class="invoked-header">Stable portal. Emissaries summoned:</div>
      <div class="invoked-list" id="invokedList"></div>
    </div>

    <div class="status-bar-bottom">
      EMBER-PROT-ALFA // Portal access implies full traceability. Missions require valid EXP.
    </div>
  </div>

  <script>
    const consoleLog = document.getElementById('consoleLog');
    const lines = [
      { raw: "Җ#%/ EMBR–NET.𝛌 // canal_scan...", translated: "[EMBERHOLM TERMINAL v1.0] Channel connected to the Core." },
      { raw: "⟟⟟⟟ ⚙ PROT-A-L4... ok", translated: "Current mission: to keep the flame alive." },
      { raw: "æ> guild/auth?...", translated: "Summons emissaries. Be part of a guild. Complete missions." },
      { raw: "æ> 72h/cycle/2d/energy/48h/…", translated: "72h rotation · 48h energy · Aura for items." },
      { raw: "æ> waiting...", translated: "Waiting for summoning amount..." }
    ];
    function pushLine(raw, tr){
      const l = document.createElement('div');
      l.className = 'console-line';
      l.textContent = raw;
      consoleLog.appendChild(l);
      setTimeout(()=>{
        const l2 = document.createElement('div');
        l2.className = 'console-line';
        l2.textContent = tr;
        consoleLog.appendChild(l2);
      }, 1000);
    }
    (function initConsole(){
      let d = 200;
      lines.forEach(obj => {
        setTimeout(()=>pushLine(obj.raw, obj.translated), d);
        d+=1100;
      });
    })();

    const invokeBtn = document.getElementById('invokeBtn');
    const qtyInput = document.getElementById('qty');
    const portalVideo = document.getElementById('portalVideo');
    const portalOverlay = document.getElementById('portalOverlay');
    const portalTitle = document.querySelector('.portal-panel-title span');
    const invokedWrapper = document.getElementById('invokedWrapper');
    const invokedList = document.getElementById('invokedList');
    const mintStatus = document.getElementById('mintStatus');
    const audioOnBtn = document.getElementById('audioOnBtn');
    const audioMuteBtn = document.getElementById('audioMuteBtn');

    // si falla la carga del video, avisamos en la consola
    portalVideo.onerror = () => {
      const warn = document.createElement('div');
      warn.className = 'console-line';
      warn.textContent = "[!] portal.mp4 no encontrado en esta ruta.";
      consoleLog.appendChild(warn);
    };

    portalVideo.muted = true;
    portalVideo.preload = "auto";

    audioOnBtn.addEventListener('click', () => {
      portalVideo.muted = false;
      audioOnBtn.textContent = "AUDIO ON ✓";
      audioMuteBtn.textContent = "MUTE";
    });
    audioMuteBtn.addEventListener('click', () => {
      portalVideo.muted = true;
      audioMuteBtn.textContent = "MUTED ✓";
      audioOnBtn.textContent = "AUDIO ON";
    });

    function fakeEmissary(id) {
      const races = ["Gith","Human","Tiefling","Draconid","Elf","Triton","Dwarf"];
      const cls   = ["Hunter","Druid","Cleric","Explorer","Bard","Paladin"];
      const guilds= ["Order of Flame","Echo Vanguard","Forge Legion","Shadow Guild","Circle of Mist"];
      const race  = races[Math.floor(Math.random()*races.length)];
      const cl    = cls[Math.floor(Math.random()*cls.length)];
      const g     = guilds[Math.floor(Math.random()*guilds.length)];
      const aura  = Math.floor(Math.random()*100)+1;
      return `#${id} ${race} ${cl} // Guild: ${g} // Aura:${aura}`;
    }

    function onMintPaid(qty) {
      portalVideo.muted = false;
      audioOnBtn.textContent = "AUDIO ON ✓";
      audioMuteBtn.textContent = "MUTE";

      portalOverlay.textContent = "Stable portal.";
      portalTitle.textContent = "STABLE PORTAL // TRANSFER COMPLETED";
      invokedWrapper.style.display = "block";
for (let i = 0; i < qty; i++) {
    const item = document.createElement('div');
    item.className = "invoked-item";

    const img = document.createElement('img');
    img.className = "invoked-thumb";
    img.src = "static/img/emissary-placeholder.png"; // si no existe, sale vacío

    const txt = document.createElement('div');
    txt.className = "invoked-text";
    txt.textContent = fakeEmissary(1000 + i + Math.floor(Math.random() * 700));

    item.appendChild(img);
    item.appendChild(txt);
    invokedList.appendChild(item);   // 👈 ahora se van SUMANDO
}

mintStatus.textContent = "STATUS: LAST INVOCATION OK";
    }

    invokeBtn.addEventListener('click', async () => {
      const qty = parseInt(qtyInput.value, 10) || 1;

      mintStatus.textContent = "STATUS: INVOCATION IN PROGRESS…";
      portalTitle.textContent = "ACTIVATING PORTAL ON UNKNOWN TERMINAL…";
      portalOverlay.textContent = "breaking mission breakthrough…";

      // 1) intento de reproducción SILENCIADO
      portalVideo.currentTime = 0;
      portalVideo.muted = true;
      try {
        await portalVideo.play();
      } catch(e) {
        console.warn("no se pudo iniciar el video en el click", e);
      }

      // 2) simulamos 1 segundo de "pago"
      setTimeout(() => {
        portalOverlay.textContent = "synchronizing with Emberholm core…";

        let shown = false;
        const showNow = () => {
          if (shown) return;
          shown = true;
          onMintPaid(qty);
        };

        portalVideo.onended = showNow;
        // por si no dispara ended
        setTimeout(showNow, 9000);

        portalVideo.muted = false;
      }, 1000);
    });
  </script>
</body>
</html>
